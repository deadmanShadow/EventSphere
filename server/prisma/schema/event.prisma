model Event {
  id              String             @id @default(uuid())
  name            String
  description     String?
  dateTime        DateTime
  location        String?
  image           String?
  minParticipants Int                @default(1)
  maxParticipants Int?
  joiningFee      Float              @default(0.0)
  currency        String             @default("USD") // "USD" or "BDT"
  status          EventStatus        @default(OPEN)
  createdBy       String
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  typeId          String
  participants    EventParticipant[]
  creator         User               @relation(fields: [createdBy], references: [id])
  type            EventType         @relation(fields: [typeId], references: [id])
  payments        Payment[]
  reviews         Review[]
  savedByUsers    SavedEvent[]

  @@map("events")
}

model EventParticipant {
  id       String   @id @default(uuid())
  eventId  String
  userId   String
  joinedAt DateTime @default(now())
  event    Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([eventId, userId])
  @@map("event_participants")
}

model Review {
  id         String   @id @default(uuid())
  rating     Int      @db.SmallInt
  comment    String?
  eventId    String
  reviewerId String
  hostId     String
  createdAt  DateTime @default(now())
  event      Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  host       User     @relation("ReviewsReceived", fields: [hostId], references: [id], onDelete: Cascade)
  reviewer   User     @relation("ReviewsGiven", fields: [reviewerId], references: [id], onDelete: Cascade)

  @@unique([eventId, reviewerId])
  @@map("reviews")
}

model Payment {
  id                 String        @id @default(uuid())
  amount             Float
  status             PaymentStatus @default(PENDING)
  stripeSessionId    String?       @unique
  paymentGatewayData Json?
  eventId            String
  userId             String
  couponId           String?
  discountAmount     Float         @default(0.0)
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  coupon             Coupon?       @relation(fields: [couponId], references: [id])
  event              Event         @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user               User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("payments")
}
